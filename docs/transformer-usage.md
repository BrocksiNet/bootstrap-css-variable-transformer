# Transformer Tool Usage

This document provides detailed information on using the `css-variables-transformer` command-line tool.

## CLI Command

```bash
npx css-variables-transformer -i input.css -o output.css -c config.json [--overrides overrides.json] [-m ast|regex]
```

Or if installed globally/locally:

```bash
css-variables-transformer -i path/to/source.css -o path/to/themed.css -c path/to/theme-mapping.json
```

### Options

- `-i, --input <inputFile>`: (Required) Path to the input CSS file.
- `-o, --output <outputFile>`: (Required) Path to write the transformed CSS file.
- `-c, --config <configFile>`: (Required) Path to the main JSON configuration file (base mapping).
- `--overrides <overridesFile>`: (Optional) Path to a JSON configuration file for overrides. Mappings in this file take precedence over the base configuration.
- `-m, --method <method>`: (Optional) Transformation method (`ast` or `regex`). Defaults to `ast`.

## Configuration Files (`config.json`, `overrides.json`)

The configuration files define the mapping between values/variables in the input CSS and the desired theme variables.

- **Base Configuration (`-c <configFile>`):** This file provides the primary set of mappings.
- **Override Configuration (`--overrides <overridesFile>`):** This optional file allows you to specify mappings that take precedence over the base configuration.

The tool merges these two configurations. If a key (the value or variable to find) exists in both the base and override files, the value (the target theme variable) from the override file is used.

**Structure:**

Each configuration file should be a JSON object where keys are the literal values (e.g., hex codes like `#0d6efd`) or existing variable names (e.g., `--original-var`) to find in the input CSS, and values are the corresponding theme variable names (e.g., `--theme-primary`) to replace them with.

**Example Base (`theme-mapping.json`):**

```json
{
  // Map specific color values to theme variables
  "#0d6efd": "--theme-primary",
  "#6c757d": "--theme-secondary",
  "#198754": "--theme-success",

  // Map specific source variables to theme variables
  "--source-primary": "--theme-primary",
  "--source-secondary": "--theme-secondary",
  "--source-success": "--theme-success",
  "--source-body-color": "--theme-text-default"
}
```

**Example Override (`theme-overrides.json`):**

```json
{
  // Override the primary color specifically for buttons
  "--source-btn-bg": "--theme-button-primary-bg",
  "--source-btn-color": "--theme-button-primary-text",
  // Override the default text color globally
  "--source-body-color": "--theme-text-override"
}
```

When running with `-c theme-mapping.json --overrides theme-overrides.json`, the final effective mapping for `--source-btn-bg` would be `--theme-button-primary-bg`, and for `--source-body-color` it would be `--theme-text-override`. Other mappings from `theme-mapping.json` would remain unchanged.

_Note: For details on the automatically generated mapping files (e.g., `default-mapping.json` and `default-mapping-var-aliases.json` produced by the extractor script), see the [Mapping Generation](./mapping-generation.md) documentation._

## Advanced Usage: Two-Step Transformation for Aliases and Theming

The [`css-variables-extractor` script](./mapping-generation.md) generates two main types of mapping files: one with raw resolved values (e.g., `default-mapping.json`) and another with variable aliases (e.g., `default-mapping-var-aliases.json`). The aliases file is particularly useful for resolving a library's internal variable structure before applying your custom theme.

To leverage this, you can use a two-step transformation process with the `css-variables-transformer` CLI:

### Step 1: Resolve Internal Library Aliases

This step takes your original CSS and the `*-var-aliases.json` file to produce an intermediate CSS where the library's internal variable references are normalized.

```bash
css-variables-transformer -i input.css -o intermediate.css -c your-library-var-aliases.json
# Or using node directly if preferred for the config structure:
# node dist/bin/cli.js -i input.css -o intermediate.css -c your-library-var-aliases.json
```

- `-i input.css`: Your source CSS file (e.g., compiled library CSS).
- `-o intermediate.css`: An intermediate output file.
- `-c your-library-var-aliases.json`: The variable alias file generated by `css-variables-extractor` (e.g., `config/default-mapping-var-aliases.json`). The transformer will primarily use the `variableAliases` key from this file for this step.

### Step 2: Apply Your Custom Theme Map

This step takes the `intermediate.css` (output from Step 1) and your main theme mapping file to produce the final themed CSS.

```bash
css-variables-transformer -i intermediate.css -o final-output.css -c your-theme-map.json [--overrides your-theme-overrides.json]
```

- `-i intermediate.css`: The CSS file from Step 1.
- `-o final-output.css`: Your final themed CSS output.
- `-c your-theme-map.json`: Your primary configuration file that maps source variables (or their raw values after alias resolution) to your theme's CSS variables.
- `--overrides your-theme-overrides.json` (Optional): Any specific overrides for your theme mapping.

This two-step approach allows you to first align the input CSS with the source library's intended variable structure using the alias file, and then apply your specific theming transformations.

## Generated Variables File (`<output-name>.vars.css`)

When the transformation process replaces values or variables in your input CSS with _target_ theme variables (like `--theme-primary` in the example above), the tool automatically generates a companion CSS file.

- **Naming:** If your output file is `output.css`, the variables file will be named `output.vars.css` and placed in the same directory.
- **Content:** This file contains empty declarations for all the unique target variables found in your mapping values. Example (`output.vars.css` based on the mapping above):

  ```css
  :root {
    --theme-primary: ;
    --theme-secondary: ;
    --theme-success: ;
    --theme-button-text: ;
    --theme-button-bg: ;
  }
  ```

- **Import:** The main transformed output file (`output.css`) will automatically have an `@import url('./output.vars.css');` rule added at the top.
- **Purpose:**
  - Provides a clear list/template of the CSS variables your transformed CSS expects.
  - Acts as a fallback. If you forget to define `--theme-primary` in your actual theme, the browser sees it's declared (even if empty) in the imported file, preventing errors related to undefined variables. You can then easily provide values by defining these variables later in the CSS cascade (e.g., in your main theme stylesheet).
